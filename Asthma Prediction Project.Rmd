---
title: "Asthma Attack Predictions"
author: "Kadie Iverson & Matthew Donaldson"
date: "2/8/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

***Next Steps: Find outliers based on approaches discussed in class and hw. ***

## Practicum of Data Analytics Project

```{r}
# Importing the data set and printing the first 6 rows to see what it looks like
asthmaDataOriginal= read.csv("Asthma_Data_File.csv")
# Removing first couple of columns because they only identify participant, no useful features. 
asthmaData = data.frame(asthmaDataOriginal[,-c(1,2,3)])
head(asthmaData)
```
## Data Description
The first summary doesn't give us to much information because half the inputs are strings. So, before looking at the properties of each feature we need to convert the strings to integers.
```{r}
# Summary gives a description for each input and output, giving you a sense of what the data looks like
summary(asthmaData)

```
```{r}
### Converting all strings to integers ###

## Can access a certain column either by a their name or column number
#asthmaData['ACTScore']
#asthmaData[14]
#asthmaData$SmokingHabit

###################################################################

## Changing age
asthmaData$Age[asthmaData$Age == 'Above 50'] = 4 
asthmaData$Age[asthmaData$Age == '41-50'] = 3
asthmaData$Age[asthmaData$Age == '31-40'] = 2 
asthmaData$Age[asthmaData$Age == '19-30'] = 1

## The above transformation still kept elements as char so 'as.integer' converts the char to int
asthmaData$Age = as.integer(asthmaData$Age)

# Gender,  binary, yes = 1 and no = 0
## DOES IT MATTER IF WE CHOOSE 0 AND 1 or -1 AND 1 ??????????????????????
asthmaData$Gender[asthmaData$Gender == 'Female'] = 1
asthmaData$Gender[asthmaData$Gender == 'Male'] = 0

asthmaData$Gender = as.integer(asthmaData$Gender)

# changing outdoor job
asthmaData$OutdoorJob[asthmaData$OutdoorJob == 'Frequently'] = 3
asthmaData$OutdoorJob[asthmaData$OutdoorJob == 'Occasionally'] = 2
asthmaData$OutdoorJob[asthmaData$OutdoorJob == 'Rarely'] = 1

asthmaData$OutdoorJob = as.integer(asthmaData$OutdoorJob)

# Outdoor activity
asthmaData$OutdoorActivities[asthmaData$OutdoorActivities == 'Extremely likely'] = 3
asthmaData$OutdoorActivities[asthmaData$OutdoorActivities == 'Neither likely or dislikely'] = 2
asthmaData$OutdoorActivities[asthmaData$OutdoorActivities == 'Not at all likely'] = 1

asthmaData$OutdoorActivities = as.integer(asthmaData$OutdoorActivities)
# Since smoking was binary, yes = 1 and no = 0
asthmaData$SmokingHabit[asthmaData$SmokingHabit == "Yes"] = 1
asthmaData$SmokingHabit[asthmaData$SmokingHabit == "No"] = 0

asthmaData$SmokingHabit = as.integer(asthmaData$SmokingHabit)
# UV Index, binary
asthmaData$UVIndex[asthmaData$UVIndex == 'Extreme'] = 1
asthmaData$UVIndex[asthmaData$UVIndex == 'Low'] = 0

asthmaData$UVIndex = as.integer(asthmaData$UVIndex)
```
Once all the data is converted into integers a summary is then done again to get some information out of the features.
```{r}

str(asthmaData) # str is nice because it gives type of each input
summary(asthmaData) # Summary is good to see median, mean, min, max...
```

As seen in the summary above, out door job, pressure and temperature seem to be the only features that have almost the same mean and median. This tells us that a lot of our data is not normally distributed. Also, it will be important to keep in mind that some of this data is binary while other are have discrete categories like out door activities which can carry values 1,2 or 3. 

Another way to check to see how the data is distributed is by looking at a histogram. Below in the histograms shows that the many of the data features are in deed not normal and most actually are discrete. One important part to notice here is that temperature doesn't actually follow a normal distribution as assumed earlier from the summary statistics. Also, interestingly enough, the humidity data looks to have a heavy left tail with the bulk of the data being on the right side, which is reflected in the summary above as the median is higher than the mean. 


```{r}

hist(asthmaData$Age, breaks = 25)
hist(asthmaData$Gender, breaks = 25)
hist(asthmaData$OutdoorJob, breaks = 25)
hist(asthmaData$OutdoorActivities, breaks = 25)
hist(asthmaData$SmokingHabit, breaks = 25)
hist(asthmaData$Humidity, breaks = 25)
hist(asthmaData$Pressure, breaks = 25)
hist(asthmaData$Temperature, breaks = 25)
hist(asthmaData$UVIndex, breaks = 25)
hist(asthmaData$WindSpeed, breaks = 25)
```

To get a better understanding the distribution of the features a box plot was made. Similar to the histograms it allows us to see if the data is skewed, the mean, median and if any categories can be separated based on a feature. One thing that I am not so sure about is using it on discrete data. I don't feel as though it contributes as much information than say temperature which is more continuous. 

```{r}

boxplot(asthmaData$Age~asthmaData$ACTScore,data=asthmaData)
boxplot(asthmaData$Gender~asthmaData$ACTScore,data=asthmaData)
boxplot(asthmaData$OutdoorJob~asthmaData$ACTScore,data=asthmaData)
boxplot(asthmaData$OutdoorActivities~asthmaData$ACTScore,data=asthmaData)
boxplot(asthmaData$SmokingHabit~asthmaData$ACTScore,data=asthmaData)
boxplot(asthmaData$Humidity~asthmaData$ACTScore,data=asthmaData)
boxplot(asthmaData$Pressure~asthmaData$ACTScore,data=asthmaData)
boxplot(asthmaData$Temperature~asthmaData$ACTScore,data=asthmaData)
boxplot(asthmaData$UVIndex~asthmaData$ACTScore,data=asthmaData)
boxplot(asthmaData$WindSpeed~asthmaData$ACTScore,data=asthmaData)

```

Lastly, A correlation matrix and heat map were made to get a sense on how dependent each input was with one another. A couple of the most important observations are that gender and age seem to have a strong negative correlation while others like out door activate and age don't have much correlation. Note the method used shows linear dependence, so the data may share a higher order dependence. 

```{r}
library(corrplot)
cor = cor(asthmaData, method = c("pearson", "kendall", "spearman"))
corrplot(cor, type = "upper", order = "hclust", 
         tl.col = "black", tl.srt = 45)

heatmap(cor, sym = TRUE)
```

```{r}
pairs(asthmaData)
```




Dixon Test
```{r}
X <- asthmaData[1:30,11]
dixon.test(X,type=0,opposite=TRUE)
dixon.test(X, type = 0, two.sided = TRUE)
```

Normal Score
```{r}
X <- asthmaData[,]

Y <- scores(X,type="z",prob=0.95)
length(Y[Y==TRUE])
A <- which(Y == TRUE)
```

Median Absolute Deviation

```{r}
X <- asthmaData[,]

#Displaying first 10 scores
Y <- scores(X,type="mad",prob=0.95)
length(Y[Y==TRUE])
B <- which(Y == TRUE)
```


Interquantile range score
check for the value of limit to be used

```{r}
X <- asthmaData[,]

#Displaying first 10 scores
Y <- scores(X,type="iqr",lim=2)
length(Y[Y==TRUE])
C <- which(Y == TRUE)
```

Depth-based Approach:

```{r}
X <- asthmaData[,]

Y <- depthout(X,cutoff=0.05)
D <- Y$`Location of Outlier`
```


Mahalanobis Distance

```{r}
X <- asthmaData[,]
Y <- maha(X,cutoff=0.9)
E <- Y$`Location of Outlier`
```

k Nearest Neighbours Distance method

```{r}
X <- asthmaData[,]
Y <- nn(X,k=5)
K <- Y$`Location of Outlier`
```


kth Nearest Neighbour Distance method

```{r}
X <- asthmaData[,]
Y <- nnk(X,k=5)
G <- Y$`Location of Outlier`
```

Outlier detection using Robust Kernal-based Outlier Factor(RKOF) algorithm

```{r}
X <- asthmaData[,]
Y <- dens(X,k=4,C=1)
H <- Y$`Location of Outlier`
```


Outlier detection using genralised dispersion

```{r}
X <- asthmaData[,]
Y <- disp(X,cutoff=0.99)
I <- Y$`Location of Outlier`
```


Join assessment of outlier detection methods

```{r}
X <- asthmaData[,]
Y <- OutlierDetection(X)
J <- Y$`Location of Outlier`
```

c) Report outlier based on consensus rule based on all the techniques that applied to your data sets.


```{r}
out_list <- append(A, B)
out_list <- append(out_list, C)
out_list <- append(out_list, D)
out_list <- append(out_list, E)
out_list <- append(out_list, K)
out_list <- append(out_list, G)
out_list <- append(out_list, H)
out_list <- append(out_list, I)
out_list <- append(out_list, J)

length(out_list)
```


```{r}
L <- as.data.frame(table(out_list))
M <- L$Freq > 5
N <- which(M == TRUE)
length(N)
```


################################################################################
## PCA Analysis

```{r}
####  Step 1: Standardization ####
# This standardizes the data with z = (value - mean)/sd
asthmaData_scaled = scale(asthmaData[,0:10]) # This standardizes the input data 
#summary(asthmaData_scaled) # Checking standardization

#### Step 2: Finding Cov matrix ####
cov_matrix = cov(asthmaData_scaled)
#cov_matrix # Checking cov_matrix
```


```{r}
#### Step 3: Computing eigen values and eigenvectors of Cov-matrix to identify principle components ###
eigen = eigen(cov_matrix)
# eigen$vectors and eigen$values for the vectors and values
#eigen$values # Looks like the eigen values are already ordered

#### Step 4: Seeing percentage of variance accounted for by each comp. ####
plot(eigen$values)
```

```{r}
#### Selecting amount of features we want #### In this case firest 8 features
                                             # capture ~95% var

# First find the percent variance in each 
sum_eig = sum(eigen$values)
per_var = eigen$values/sum_eig
#print(per_var) # Gives percentage of variance in each component
# We will select amount of components that gives us at least 95% of the variance

# From the output this can be seen to be the first 8 eigen values.
#sum(per_var[0:7])

featureVector = eigen$vectors[,0:7] # Getting features we want
dim(asthmaData_scaled)
dim(featureVector)
asthmaData.pca = asthmaData_scaled %*% featureVector # Transforming Data
```



```{r}
#### Checking work from above #### Do Not USe

#asthmaData.pca<-princomp(asthmaData_scaled[])
#plot(asthmaData.pca, main="Proportions of variance explained by the components")
#head(asthmaData.pca)
head(asthmaData[,11])
```

## Trying a linear regression
```{r}
# y = b0 + b1*v1 + b2*v2 ... + bn*vn
asthmaData.pca = cbind(asthmaData.pca, asthmaData[,11])
#head(asthmaData.pca)

v1 = asthmaData.pca[,1]
v2 = asthmaData.pca[,2]
v3 = asthmaData.pca[,3]
v4 = asthmaData.pca[,4]
v5 = asthmaData.pca[,5]
v6 = asthmaData.pca[,6]
v7 = asthmaData.pca[,7]

y = asthmaData.pca[,8]

fit = lm(y ~ v1 + v2 + v3 + v4 + v5 + v6 + v7)

summary(fit)
```






